/*! Week Scheduler Widget - v0.0.1 - 2014-11-10
* http://darksmo.github.io/jquery-weekscheduler-widget/
* Copyright (c) 2014; Licensed MIT */
!function(a){var b="weekSchedulerWidget",c=[],d={EVT_CONFIRM_CLICKED:"onConfirm."+b,EVT_CANCEL_CLICKED:"onCancel."+b},e={setMinutes:function(b){var c=this,d=c.data("settings"),f=e._enumerateMinutes.call(c,d.minutesPrecision),g=a(f).map(function(a,b){return b.number});return-1===g.index(b)&&a.error("the minute "+b+" is not valid and should be one of "+g.toArray().join(",")),c.find(".weekSchedulerMinuteOption[name!=minute"+b+"]").prop("selected",""),c.find(".weekSchedulerMinuteOption[name=minute"+b+"]").prop("selected","selected"),c},setHour:function(a){var b=this;return b.find(".weekSchedulerHourOption[name!=hour"+a+"]").prop("selected",""),b.find(".weekSchedulerHourOption[name=hour"+a+"]").prop("selected","selected"),b},setWeek:function(a){var b=this,c=e._getWeekOfDay.call(b,a),d=c[0].getTime()+"-"+c[1].getTime();return b.find("option[value!="+d+"]").prop("selected",""),b.find("option[value="+d+"]").prop("selected","selected"),b},setDays:function(a){var b,c,d=this,e={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1};for(b=0;b<a.length;b++)c=a[b],e[c]=!0;var f;for(f in e)e.hasOwnProperty(f)&&(e[f]?d.find("input[value="+f+"]").prop("checked","checked"):d.find("input[value="+f+"]").prop("checked",""));return d},setSelection:function(a){var b=this;return e.setWeek.call(b,a.week[0]),e.setDays.call(b,a.days),e.setHour.call(b,a.hour),e.setMinutes.call(b,a.minutes),b},getSelection:function(){var b=this,c=[];return a("input[name=days]:checked").each(function(){c.push(parseInt(a(this).val(),10))}),{week:b.find(".weekSchedulerWidgetWeeksSelect").val().split("-").map(function(a){return new Date(parseInt(a,10))}),days:c,hour:b.find(".weekSchedulerWidgetHourSelect").val(),minutes:b.find(".weekSchedulerWidgetMinutesSelect").val()}},_getSelectedDates:function(a){var b,d,e=[],f=a.days.length;for(b=0;f>b;b++){d=a.days[b];var g=new Date(a.week[0]);g.setDate(g.getDate()+c.indexOf(d)),g.setHours(a.hour),g.setMinutes(a.minutes),e.push(g)}return e},getSelectedDates:function(){var a=this,b=e.getSelection.call(a);return e._getSelectedDates.call(a,b)},setDates:function(b){var c,d,f,g,h,i,j,k,l,m=this,n={},o=[];for(l=0;j=b[l++];){g=j.getHours(),h=j.getMinutes(),i=e._getWeekOfDay.call(m,j);var p=j.getDay();n.hasOwnProperty(p)||(n[p]=1,o.push(p)),"undefined"==typeof f?(f=i,d=h,c=g):((f[0].getTime()!==i[0].getTime()||f[1].getTime()!==i[1].getTime())&&a.error("cannot use this dateset because not all the dates fall in the same week range"),d!==h&&a.error("cannot use this dateset because not all the dates are set to the same minute"),c!==g&&a.error("cannot use this dateset because not all the dates are set to the same hour")),k=j}return e.setSelection.call(m,{week:[k,k],days:o,hour:g,minutes:h}),m},show:function(){var a=this,b=a.data("settings");if("block"!==a.css("display")&&"inline"!==a.css("display"))return b.onBeforeShow.call(a)&&a.show(),b.onAfterShow.call(a),a},hide:function(a){var b=this,c=b.data("settings");if("none"!==b.css("display")){a="undefined"==typeof a?!0:a;var d=!0;return a&&!c.onBeforeHide.call(b)&&(d=!1),d&&b.hide(),a&&c.onAfterHide.call(b),b}},_buildDayMapping:function(b,c){var d=[];c!==b-1&&a.error("Invalid indices, must be end = start - 1"),(c>=7||0>c)&&a.error("Invalid endDay index, must be between 0 and 6"),(b>=7||0>b)&&a.error("Invalid startDay index, must be between 0 and 6");for(var e=b;e!==c;)d.push(e++),7===e&&(e=0);return d.push(e++),d},_bindEvents:function(){var b=this;b.bind("click",function(c){if("undefined"!=typeof c.target){var e=a(c.target);e.hasClass("weekSchedulerWidgetButtonCancel")?b.trigger(a.Event(d.EVT_CANCEL_CLICKED)):e.hasClass("weekSchedulerWidgetButtonConfirm")&&b.trigger(a.Event(d.EVT_CONFIRM_CLICKED))}})},_enumerateMinutes:function(a){var b,c=[];for(b=0;60>b;b+=a)c.push({number:60===b?0:b,string:("00"+b).slice(-2)});return c},_getMinutesMarkup:function(a){var b=this,c=[];c.push('<select class="weekSchedulerWidgetMinutesSelect">');var d,f,g=e._enumerateMinutes.call(b,a);for(d=0;f=g[d++];)c.push(['<option class="weekSchedulerMinuteOption" name="minute',f.number,'" value="',f.number,'">',f.string,"</option>"].join(""));return c.push("</select>"),c.join("")},_getHoursMarkup:function(){var a,b=['<select class="weekSchedulerWidgetHourSelect">'];for(a=1;24>a;a++)b.push(['<option class="weekSchedulerHourOption" name="hour',a,'" value="',a,'">',("00"+a).slice(-2),"</option>"].join(""));return b.push('<option name="hour0" value="0">00</option>'),b.push("</select>"),b.join("")},_getDaysMarkup:function(){var a,b,d=this,e=d.data("settings"),f=[];for(a=0;b=e.localization.dayNames[a];a++)f.push(['<div class="weekSchedulerWidgetDay">','<input id="weekSchedulerWidgetDay'+e.localization.dayNames[a]+'" type="checkbox" name="days" value="',c[a],'" />','<label for="weekSchedulerWidgetDay'+b+'" class="weekSchedulerWidgetDayName">',b,"</label>","</div>"].join(""));return f.join("")},_getWeekOfDay:function(b){var c=this,d=c.data("settings");"undefined"==typeof b&&a.error("_getWeekOfDay: dayDate parameter must be not null");var e=function(a,b,c){for(var d=new Date(a);d.getDay()!==c;)d.setDate(d.getDate()+b);return d},f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),g=e(f,-1,d.firstDayOfWeek),h=e(f,1,d.lastDayOfWeek);return[g,h]},_getWeeksMarkup:function(a,b){var c,d=this,f=d.data("settings"),g=['<select class="weekSchedulerWidgetWeeksSelect">'],h=new Date(a),i=e._getWeekOfDay.call(d,b);do c=e._getWeekOfDay.call(d,h),g.push(['<option value="',c[0].getTime()+"-"+c[1].getTime(),'">',c[0].getDate()," ",f.localization.monthNames[c[0].getMonth()]," ",c[0].getFullYear()," ",f.localization.to," ",c[1].getDate()," ",f.localization.monthNames[c[1].getMonth()]," ",c[1].getFullYear(),"</option>"].join("")),h.setDate(h.getDate()+7);while(c[0].getTime()!==i[0].getTime()&&c[1].getTime()!==i[1].getTime());return g.push("</select>"),g.join("")},_getWidgetHtml:function(){var a=this,b=a.data("settings"),c=['<div class="weekSchedulerWidgetContainer">','<span class="weekSchedulerWidgetTitle">',b.localization.title,"</span>",'<div class="weekSchedulerWidgetLabel">',b.localization.week,"</div>",e._getWeeksMarkup.call(a,b.startDate,b.endDate),'<div class="weekSchedulerWidgetLabel">',b.localization.days,"</div>",e._getDaysMarkup.call(a),'<div class="weekSchedulerWidgetClearfix"></div>','<div class="weekSchedulerWidgetLabel">',b.localization.time,"</div>",'<div class="weekSchedulerWidgetLayoutHorizontal">','<div class="weekSchedulerWidgetHour">','<div class="weekSchedulerWidgetSubLabel">',b.localization.hour,"</div>",e._getHoursMarkup.call(a),"</div>",'<div class="weekSchedulerWidgetMinute">','<div class="weekSchedulerWidgetSubLabel">',b.localization.minute,"</div>",e._getMinutesMarkup.call(a,b.minutesPrecision),"</div>","</div>",'<div class="weekSchedulerWidgetClearfix"></div>','<div class="weekSchedulerWidgetLayoutHorizontalRight">','<div class="weekSchedulerWidgetButton weekSchedulerWidgetButtonConfirm">',b.localization.confirm,"</div>",'<div class="weekSchedulerWidgetButton weekSchedulerWidgetButtonCancel">',b.localization.cancel,"</div>","</div>",'<div class="weekSchedulerWidgetClearfix"></div>',"</div>"].join("");return c},_validateMonthNames:function(b){return 12!==b.length&&a.error("You need to provide exactly 12 months in localization.monthNames. Got "+b.length+" months instead"),!0},_validateMinutesPrecision:function(b){return"number"!=typeof b&&a.error("please provide a number for the minutesPrecision option"),0>=b&&a.error("the minutesPrecision parameter must be >= 1 and <= 30"),!0},destroy:function(){var a=this;return a.unbind("click"),a.html(""),c=[],a},init:function(b){var d=a.extend({localization:{title:"Schedule item",week:"Week",days:"Days",time:"Time",hour:"Hour",minute:"Minute",confirm:"Add",cancel:"Cancel",to:"to",dayNames:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]},minutesPrecision:15,startDate:new Date,endDate:function(){var a=new Date;return a.setMonth(a.getMonth()+1),a}(),firstDayOfWeek:1,lastDayOfWeek:0,hideOnStart:!1,onBeforeShow:function(){return!0},onAfterShow:function(){},onBeforeHide:function(){return!0},onAfterHide:function(){}},b);return e._validateMonthNames(d.localization.monthNames),e._validateMinutesPrecision(d.minutesPrecision),c=e._buildDayMapping(d.firstDayOfWeek,d.lastDayOfWeek),this.each(function(){var b=a(this);if(b.data("settings",d),d.hideOnStart){var c=!1;e.hide.call(b,c)}e._bindEvents.call(b);var f=e._getWidgetHtml.call(b);b.append(f)})}};a.fn[b]=function(c){if(e[c]){if(this.data("initialized")===!0)return e[c].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+c+" called on an uninitialized instance of "+b)}return"object"!=typeof c&&c?void a.error("Cannot call method "+c):(this.data("initialized",!0),e.init.apply(this,arguments))}}(jQuery);